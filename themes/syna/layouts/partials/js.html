{{ "<!-- Theme Code -->" | safeHTML }}
{{- if $.Scratch.Get "react" }}
  <script>
    if (!window.synaPortals) {
      window.synaPortals = {};
    }
  </script>
{{- end -}}

{{- $.Scratch.Set "loaded_scripts" slice -}}
{{- range ($.Scratch.Get "js") -}}
  {{- if or (and .name (not (in ($.Scratch.Get "loaded_scripts") .name))) (not (isset . "name")) -}}
    {{- if .url -}}
      <script 
        {{- if (.async | default true) -}}
          {{- safeHTMLAttr (print " async") -}}
        {{- end -}}
        {{- if (.defer | default true) -}}
          {{- safeHTMLAttr (print " defer") -}}
        {{- end -}}
        {{- safeHTMLAttr (printf " src=\"%s\"" .url) -}}></script>
    {{- else if .file }}
      {{- $script_template := resources.Get (printf "scripts/%s" .file) -}}
      {{- $script := $script_template | resources.Fingerprint | resources.Minify }}
      <script 
        {{- if (.async | default true) -}}
          {{- safeHTMLAttr (print " async") -}}
        {{- end -}}
        {{- if (.defer | default true) -}}
          {{- safeHTMLAttr (print " defer") -}}
        {{- end -}}
        {{- safeHTMLAttr (printf " src=\"%s\"" ($script.RelPermalink | relLangURL)) -}}></script>
    {{- else if .script -}}
      {{ .script | safeHTML | resources.Minify }}
    {{- end -}}

    {{- if .name -}}
      {{- $.Scratch.Add "loaded_scripts" .name -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
{{- template "_internal/google_analytics_async.html" . -}}

{{- if .Site.Params.analytics.piwik -}}
  {{- partial "_analytics/piwik.html" . -}}
{{- end -}}

{{- range (.Scratch.Get "page_config") -}}
  {{- range .Params.config -}}
    {{- partial "helpers/config.html" (dict "root" $ "head" false "type" .type "data" .) -}}
  {{- end -}}
{{- end -}}

<script>
  window.intercomSettings = {
    app_id: "i8tzz3ek",
    alignment: 'right',
    horizontal_padding: 20,
    vertical_padding: 20
  };
</script>
<script>(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/i8tzz3ek';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();</script>